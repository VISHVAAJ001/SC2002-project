@startuml

' --- Settings ---
skinparam classAttributeIconSize 0
hide empty members
skinparam packageStyle rect
skinparam linetype ortho

' --- Enums ---
enum ApplicationStatus {
    PENDING
    SUCCESSFUL
    UNSUCCESSFUL
    BOOKED
}
enum MaritalStatus {
    SINGLE
    MARRIED
}
enum OfficerRegStatus {
    PENDING
    APPROVED
    REJECTED
}
enum UserRole {
    APPLICANT
    HDB_OFFICER
    HDB_MANAGER
}
enum FlatType {
    TWO_ROOM
    THREE_ROOM
}

' --- Entity Layer ---
package Entity <<Folder>> {
    abstract class User {
        # nric : String
        # passwordHash : String
        # name: String
        # age : int
        # maritalStatus : MaritalStatus
        # role : UserRole <<get>>
        + {abstract} getRole() : UserRole
        + getNric() : String
        + getName() : String
        + getAge() : int
        + getMaritalStatus() : MaritalStatus
        + getPasswordHash() : String
        + updatePasswordHash(newHash: String) : void
    }

    class Applicant extends User {
        + Applicant(nric: String, hash: String, name: String, age: int, status: MaritalStatus)
        + getRole() : UserRole <<override>>
    }

    abstract class HDBStaff extends User {
         + HDBStaff(nric: String, hash: String, name: String, age: int, status: MaritalStatus)
    }

    class HDBOfficer extends HDBStaff {
        + HDBOfficer(nric: String, hash: String, name: String, age: int, status: MaritalStatus)
        + getRole() : UserRole <<override>>
    }

    class HDBManager extends HDBStaff {
        + HDBManager(nric: String, hash: String, name: String, age: int, status: MaritalStatus)
        + getRole() : UserRole <<override>>
    }

    class ProjectFlatInfo {
        + flatType : FlatType
        + totalUnits : int
        + remainingUnits : int
        + price : double
        + ProjectFlatInfo(flatType: FlatType, totalUnits: int, remainingUnits: int, price: double)
        + decreaseRemainingUnits() : boolean
        + increaseRemainingUnits() : void
        + getTypeName() : String ' Returns enum name or custom string
        + getTotalUnits() : int
        + getRemainingUnits() : int
        + getPrice() : double
    }

    class Project {
        + projectId : String
        + projectName : String
        + neighborhood : String
        + flatTypes : Map<FlatType, ProjectFlatInfo> <<get>>
        + openingDate : LocalDate
        + closingDate : LocalDate
        + managerNric : String
        + maxOfficerSlots : int
        + isVisible : boolean
        + approvedOfficerNrics : List<String> <<get>>
        + Project(id: String, name: String, neighborhood: String, flatTypes: Map<FlatType, ProjectFlatInfo>, openDate: LocalDate, closeDate: LocalDate, managerNric: String, maxOfficerSlots: int)
        + setVisibility(visible: boolean) : void
        + addApprovedOfficer(officerNric: String) : boolean
        + removeApprovedOfficer(officerNric: String) : boolean
        + getFlatInfo(flatType: FlatType) : ProjectFlatInfo <<nullable>>
        + getProjectId() : String
        + getProjectName() : String
        + getNeighborhood() : String
        + getOpeningDate() : LocalDate
        + getClosingDate() : LocalDate
        + getManagerNric() : String
        + getMaxOfficerSlots() : int
        + isVisible() : boolean
        + getApprovedOfficerNrics() : List<String>
    }

    class Application {
        + applicationId : String
        + applicantNric : String <<get>>
        + projectId : String <<get>>
        + submissionDate : LocalDate <<get>>
        + status : ApplicationStatus
        + requestedWithdrawalDate : LocalDate <<nullable>> ' Set by ApplicationService
        + preferredFlatType : FlatType <<nullable>> <<get>> <<set>>
        + Application(appId: String, applicantNric: String, projId: String, submissionDate: LocalDate)
        + setStatus(newStatus: ApplicationStatus) : void ' Called by ApplicationService
        + getApplicationId() : String
        + getStatus() : ApplicationStatus
    }

    class Booking {
        + bookingId : String
        + applicationId : String <<get>> <<Unique>>
        + applicantNric : String <<get>>
        + projectId : String <<get>>
        + bookedFlatType : FlatType <<get>>
        + bookingDate : LocalDate <<get>>
        + Booking(bookId: String, appId: String, applicantNric: String, projId: String, flatType: FlatType, bookingDate: LocalDate)
        + getBookingId() : String
        + getBookedFlatType() : FlatType
        + getBookingDate() : LocalDate
    }

    class BookingReceiptInfo {
        + applicantName : String
        + applicantNric : String
        + applicantAge : int
        + applicantMaritalStatus : MaritalStatus
        + bookedFlatType : FlatType
        + projectName : String
        + projectNeighborhood : String
        + bookingId : String
        + bookingDate : LocalDate
        ' + Add constructor and getters
    }

    class Enquiry {
        + enquiryId : String
        + userNric : String <<get>>
        + projectId : String <<nullable>>
        + content : String
        + reply : String <<nullable>>
        + isReplied : boolean
        + submissionDate : LocalDate <<get>>
        + replyDate : LocalDate <<nullable>>
        + Enquiry(enqId: String, userNric: String, projId: String, content: String, submissionDate: LocalDate)
        + addReply(replyContent: String, replyDate: LocalDate) : void
        + editContent(newContent: String) : void
        + getEnquiryId() : String
        + getProjectId() : String <<nullable>>
        + getContent() : String
        + getReply() : String <<nullable>>
        + isReplied() : boolean
        + getReplyDate() : LocalDate <<nullable>>
    }

     class OfficerRegistration {
        + registrationId : String
        + officerNric : String <<get>>
        + projectId : String <<get>>
        + requestDate : LocalDate <<get>>
        + status : OfficerRegStatus
        + OfficerRegistration(regId: String, officerNric: String, projId: String, requestDate: LocalDate)
        + setStatus(newStatus: OfficerRegStatus) : void ' Called by OfficerRegistrationService
        + getRegistrationId() : String
        + getStatus() : OfficerRegStatus
    }
}

' --- Exception Package ---
package Exception <<Folder>> {
    class ApplicationException extends Exception {
        + ApplicationException(message: String)
    }
    class AuthenticationException extends Exception {
        + AuthenticationException(message: String)
    }
    class BookingException extends Exception {
        + BookingException(message: String)
    }
    class DataAccessException extends RuntimeException {
        + DataAccessException(message: String, cause: Throwable)
    }
    class RegistrationException extends Exception {
        + RegistrationException(message: String)
    }
     class InvalidInputException extends Exception {
        + InvalidInputException(message: String)
    }
}

' --- Repository Package ---
package Repository <<Folder>> {
    interface IRepository<T, ID> <<DIP>> {
        + findById(id : ID) : T <<nullable>>
        + findAll() : Map<ID, T>
        + save(entity : T) : void
        + saveAll(entities: Map<ID, T>) : void
        + loadAll() : Map<ID, T> <<throws DataAccessException>>
        ' + deleteById(id: ID) : void ' Optional
    }

    interface IUserRepository extends IRepository<User, String> {
        ' Add any user-specific query methods here (if needed later)
    }

    interface IProjectRepository extends IRepository<Project, String> {
        ' Add any project-specific query methods here (if needed later)
    }

    interface IApplicationRepository extends IRepository<Application, String> {
        + findByApplicantNric(nric: String) : Application <<nullable>>
        + findByProjectId(projectId: String) : List<Application>
    }

    interface IBookingRepository extends IRepository<Booking, String> {
        + findByApplicantNric(nric: String) : Booking <<nullable>>
        + findByApplicationId(applicationId: String) : Booking <<nullable>>
    }

    interface IEnquiryRepository extends IRepository<Enquiry, String> {
        + findByUserNric(nric: String) : List<Enquiry>
        + findByProjectId(projectId: String) : List<Enquiry>
    }

    interface IOfficerRegistrationRepository extends IRepository<OfficerRegistration, String> {
        + findByOfficerNric(nric: String) : List<OfficerRegistration>
        + findByProjectId(projectId: String) : List<OfficerRegistration>
    }

    class UserRepository implements IUserRepository {
        - USER_FILE_PATH : String <<static>> final
        - users : Map<String, User>
        + UserRepository()
        + loadAll() : Map<String, User> <<throws DataAccessException>>
        + saveAll(users: Map<String, User>) : void
        + save(user: User) : void
        + findById(nric: String) : User <<nullable>>
        + findAll() : Map<String, User>
    }

    class ProjectRepository implements IProjectRepository {
        - PROJECT_FILE_PATH : String <<static>> final
        - FLAT_INFO_FILE_PATH : String <<static>> final
        - projects : Map<String, Project>
        + ProjectRepository()
        + loadAll() : Map<String, Project> <<throws DataAccessException>>
        + saveAll(projects: Map<String, Project>) : void
        + save(project: Project) : void
        + findById(projectId: String) : Project <<nullable>>
        + findAll() : Map<String, Project>
    }

    class ApplicationRepository implements IApplicationRepository {
        - APPLICATION_FILE_PATH : String <<static>> final
        - applications : Map<String, Application>
        + ApplicationRepository()
        + loadAll() : Map<String, Application> <<throws DataAccessException>>
        + saveAll(applications: Map<String, Application>) : void
        + save(application: Application) : void
        + findById(applicationId: String) : Application <<nullable>>
        + findAll() : Map<String, Application>
        + findByApplicantNric(nric: String) : Application <<nullable>>
        + findByProjectId(projectId: String) : List<Application>
    }

    class BookingRepository implements IBookingRepository {
        - BOOKING_FILE_PATH : String <<static>> final
        - bookings : Map<String, Booking>
        + BookingRepository()
        + loadAll() : Map<String, Booking> <<throws DataAccessException>>
        + saveAll(bookings: Map<String, Booking>) : void
        + save(booking: Booking) : void
        + findById(bookingId: String) : Booking <<nullable>>
        + findAll() : Map<String, Booking>
        + findByApplicantNric(nric: String) : Booking <<nullable>>
        + findByApplicationId(applicationId: String) : Booking <<nullable>>
    }

    class EnquiryRepository implements IEnquiryRepository {
        - ENQUIRY_FILE_PATH : String <<static>> final
        - enquiries : Map<String, Enquiry>
        + EnquiryRepository()
        + loadAll() : Map<String, Enquiry> <<throws DataAccessException>>
        + saveAll(enquiries: Map<String, Enquiry>) : void
        + save(enquiry: Enquiry) : void
        + findById(enquiryId: String) : Enquiry <<nullable>>
        + findAll() : Map<String, Enquiry>
        + findByUserNric(nric: String) : List<Enquiry>
        + findByProjectId(projectId: String) : List<Enquiry>
    }

    class OfficerRegistrationRepository implements IOfficerRegistrationRepository {
        - OFFICER_REGISTRATION_FILE_PATH : String <<static>> final
        - registrations : Map<String, OfficerRegistration>
        + OfficerRegistrationRepository()
        + loadAll() : Map<String, OfficerRegistration> <<throws DataAccessException>>
        + saveAll(registrations: Map<String, OfficerRegistration>) : void
        + save(registration: OfficerRegistration) : void
        + findById(registrationId: String) : OfficerRegistration <<nullable>>
        + findAll() : Map<String, OfficerRegistration>
        + findByOfficerNric(nric: String) : List<OfficerRegistration>
        + findByProjectId(projectId: String) : List<OfficerRegistration>
    }
}

' --- Utility Package ---
package Utility <<Folder>> {
    class FileUtil <<Utility>> {
        + {static} readCsvLines(filePath: String) : List<String[]> <<throws IOException>>
        + {static} writeCsvLines(filePath: String, data: List<String[]>, header: String[]) : void <<throws IOException>>
        + {static} parseLocalDate(dateString: String) : LocalDate <<nullable>>
        + {static} formatLocalDate(date: LocalDate) : String
        + {static} parseEnum(enumClass: Class<E>, value: String, defaultValue: E) : E
        + {static} joinList(list: List<String>, delimiter: String) : String
        + {static} splitString(str: String, delimiter: String) : List<String>
        + {static} parseIntOrDefault(value: String, defaultValue: Integer) : Integer
        + {static} parseDoubleOrDefault(value: String, defaultValue: Double) : Double
    }
    class ValidatationUtil <<Utility>> {
        + {static} isValidNric(nric: String) : boolean
        ' Add other necessary static input methods
    }
    class PasswordUtil <<Utility>> {
        + {static} hashPassword(plainPassword: String) : String
        + {static} verifyPassword(plainPassword: String, storedHash: String) : boolean
    }
    class IdGenerator <<Utility>> {
        + {static} generateApplicationId() : String
        + {static} generateBookingId() : String
        + {static} generateEnquiryId() : String
        + {static} generateOfficerRegId() : String
        + {static} generateProjectId() : String
        + {static} generateProjectFlatInfoId() : String
    }
}

' --- Service Layer ---
package Service <<Folder>> {
    interface IUserService <<ISP>> {
        + findUserById(nric: String) : User <<nullable>>
        + findUserNames(nrics: Collection<String>) : Map<String, String>
    }

    class UserService implements IUserService {
        - userRepository : IUserRepository
        + UserService(userRepository: IUserRepository)
        + findUserById(nric: String) : User <<nullable>>
        + findUserNames(nrics: Collection<String>) : Map<String, String>
    }

    interface IAuthenticationService <<ISP>> {
        + login(nric: String, password: String) : User <<throws AuthenticationException>>
        + changePassword(user: User, newPassword: String) : boolean
    }
    class AuthenticationService implements IAuthenticationService {
        - userRepository : IUserRepository
        + AuthenticationService(userRepository: IUserRepository)
        + login(nric: String, password: String) : User <<throws AuthenticationException>>
        + changePassword(user: User, newPassword: String) : boolean
    }

    interface IBookingService <<ISP>> {
         + performBooking(officer: HDBOfficer, applicantNric: String, flatType: FlatType) : Booking <<throws BookingException>>
    }
    class BookingService implements IBookingService {
        - applicationRepo : IApplicationRepository
        - projectRepo : IProjectRepository
        - bookingRepo : IBookingRepository
        - userRepo : IUserRepository
        + BookingService(appRepo: IApplicationRepository, projRepo: IProjectRepository, bookingRepo: IBookingRepository, userRepo: IUserRepository)
        + performBooking(officer: HDBOfficer, applicantNric: String, flatType: FlatType) : Booking <<throws BookingException>>
    }

    interface IReceiptService <<ISP>> {
        + generateBookingReceipt(booking: Booking) : BookingReceiptInfo <<throws DataAccessException>>
    }
    class ReceiptService implements IReceiptService {
         - bookingRepo : IBookingRepository
         - userRepo : IUserRepository
         - projectRepo : IProjectRepository
        + ReceiptService(bookRepo: IBookingRepository, userRepo: IUserRepository, projRepo: IProjectRepository)
        + generateBookingReceipt(booking: Booking) : BookingReceiptInfo <<throws DataAccessException>>
    }

    interface IEligibilityService <<ISP>> {
         + checkApplicationEligibility(user: User, project: Project) : boolean
         + checkOfficerRegistrationEligibility(officer: HDBOfficer, project: Project, allRegistrations: Collection<OfficerRegistration>, allApplications: Collection<Application>) : boolean
     }
     class EligibilityService implements IEligibilityService {
         + EligibilityService()
         + checkApplicationEligibility(user: User, project: Project) : boolean
         + checkOfficerRegistrationEligibility(officer: HDBOfficer, project: Project, allRegistrations: Collection<OfficerRegistration>, allApplications: Collection<Application>) : boolean
     }

      interface IProjectService <<ISP>> {
        + createProject(manager: HDBManager, name: String, neighborhood: String, flatInfoMap: Map<FlatType, ProjectFlatInfo>, openDate: LocalDate, closeDate: LocalDate, officerSlots: int) : Project <<throws RegistrationException>>;
        + editCoreProjectDetails(manager: HDBManager, projectId: String, name: String, neighborhood: String, openDate: LocalDate, closeDate: LocalDate, officerSlots: int) : boolean;
        + deleteProject(manager: HDBManager, projectId: String) : boolean;
        + toggleVisibility(manager: HDBManager, projectId: String) : boolean;
        + getVisibleProjectsForUser(user: User, filters: Map<String, Object>) : List<Project>;
        + getAllProjects(user: User, filters: Map<String, Object>) : List<Project>;
        + getProjectsManagedBy(managerNric: String) : List<Project>;
        + findProjectById(projectId: String) : Project <<nullable>>;
    }

    class ProjectService implements IProjectService {
        - projectRepo : IProjectRepository;
        - userRepo : IUserRepository;
        - eligibilityService : IEligibilityService;
        + ProjectService(projectRepo: IProjectRepository, userRepo: IUserRepository, eligSvc: IEligibilityService);
        + createProject(manager: HDBManager, name: String, neighborhood: String, flatInfoMap: Map<FlatType, ProjectFlatInfo>, openDate: LocalDate, closeDate: LocalDate, officerSlots: int) : Project <<throws RegistrationException>>;
        + editCoreProjectDetails(manager: HDBManager, projectId: String, name: String, neighborhood: String, openDate: LocalDate, closeDate: LocalDate, officerSlots: int) : boolean;
        + deleteProject(manager: HDBManager, projectId: String) : boolean;
        + toggleVisibility(manager: HDBManager, projectId: String) : boolean;
        + getVisibleProjectsForUser(user: User, filters: Map<String, Object>) : List<Project>;
        + getAllProjects(user: User, filters: Map<String, Object>) : List<Project>;
        + getProjectsManagedBy(managerNric: String) : List<Project>;
        + findProjectById(projectId: String) : Project <<nullable>>;
    }

    interface IApplicationService <<ISP>> {
        + submitApplication(user: User, projectId: String, preferredFlatType: FlatType <<nullable>>) : Application <<throws ApplicationException>>
        + requestWithdrawal(user: User) : boolean <<throws ApplicationException>>;
        + reviewApplication(manager: HDBManager, applicationId: String, approve: boolean) : boolean <<throws ApplicationException>>;
        + reviewWithdrawal(manager: HDBManager, applicationId: String, approve: boolean) : boolean <<throws ApplicationException>>;
        + getApplicationForUser(applicantNric: String) : Application <<nullable>>;
        + getApplicationsByProject(projectId: String) : List<Application>;
        + getApplicationsByStatus(status: ApplicationStatus) : List<Application>;
    }
    class ApplicationService implements IApplicationService {
        - applicationRepo : IApplicationRepository;
        - projectRepo : IProjectRepository;
        - eligibilityService : IEligibilityService;
        - userRepo : IUserRepository;
        - bookingRepo : IBookingRepository;
        + ApplicationService(appRepo: IApplicationRepository, projRepo: IProjectRepository, eligSvc: IEligibilityService, userRepo: IUserRepository, bookingRepo: IBookingRepository);
        + submitApplication(user: User, projectId: String, preferredFlatType: FlatType <<nullable>>) : Application <<throws ApplicationException>>
        + requestWithdrawal(user: User) : boolean <<throws ApplicationException>>;
        + reviewApplication(manager: HDBManager, applicationId: String, approve: boolean) : boolean <<throws ApplicationException>>;
        + reviewWithdrawal(manager: HDBManager, applicationId: String, approve: boolean) : boolean <<throws ApplicationException>>;
        + getApplicationForUser(applicantNric: String) : Application <<nullable>>;
        + getApplicationsByProject(projectId: String) : List<Application>;
        + getApplicationsByStatus(status: ApplicationStatus) : List<Application>;
    }

    interface IOfficerRegistrationService <<ISP>> {
        + requestProjectRegistration(officer: HDBOfficer, projectId: String) : OfficerRegistration <<throws RegistrationException>>;
        + reviewRegistration(manager: HDBManager, registrationId: String, approve: boolean) : boolean <<throws RegistrationException>>;
        + getRegistrationStatus(officer: HDBOfficer, projectId: String) : OfficerRegStatus <<nullable>>;
        + getPendingRegistrations() : List<OfficerRegistration>;
        + getRegistrationsByProject(projectId: String) : List<OfficerRegistration>;
        + getRegistrationsByOfficer(officerNric: String) : List<OfficerRegistration>;
    }
    class OfficerRegistrationService implements IOfficerRegistrationService {
        - registrationRepo : IOfficerRegistrationRepository;
        - projectRepo : IProjectRepository;
        - applicationRepo : IApplicationRepository;
        - eligibilityService : IEligibilityService;
        + OfficerRegistrationService(regRepo: IOfficerRegistrationRepository, projRepo: IProjectRepository, appRepo: IApplicationRepository, eligSvc: IEligibilityService);
        + requestProjectRegistration(officer: HDBOfficer, projectId: String) : OfficerRegistration <<throws RegistrationException>>;
        + reviewRegistration(manager: HDBManager, registrationId: String, approve: boolean) : boolean <<throws RegistrationException>>;
        + getRegistrationStatus(officer: HDBOfficer, projectId: String) : OfficerRegStatus <<nullable>>;
        + getPendingRegistrations() : List<OfficerRegistration>;
        + getRegistrationsByProject(projectId: String) : List<OfficerRegistration>;
    }

    interface IEnquiryService <<ISP>> {
        + createEnquiry(user: User, projectId: String <<nullable>>, content: String) : Enquiry;
        + editEnquiry(enquiryId: String, newContent: String, user: User) : boolean;
        + deleteEnquiry(enquiryId: String, user: User) : boolean;
        + replyToEnquiry(enquiryId: String, replyContent: String, staff: HDBStaff) : boolean;
        + viewMyEnquiries(user: User) : List<Enquiry>;
        + viewAllEnquiries() : List<Enquiry>;
        + viewProjectEnquiries(projectId: String) : List<Enquiry>;
        + findEnquiryById(enquiryId: String) : Enquiry <<nullable>>;
    }
    class EnquiryService implements IEnquiryService {
        - enquiryRepo : IEnquiryRepository;
        + EnquiryService(enquiryRepo: IEnquiryRepository);
        + createEnquiry(user: User, projectId: String <<nullable>>, content: String) : Enquiry;
        + editEnquiry(enquiryId: String, newContent: String, user: User) : boolean;
        + deleteEnquiry(enquiryId: String, user: User) : boolean;
        + replyToEnquiry(enquiryId: String, replyContent: String, staff: HDBStaff) : boolean;
        + viewMyEnquiries(user: User) : List<Enquiry>;
        + viewAllEnquiries() : List<Enquiry>;
        + viewProjectEnquiries(projectId: String) : List<Enquiry>;
        + findEnquiryById(enquiryId: String) : Enquiry <<nullable>>;
    }

     interface IReportService <<ISP>> {
        + generateBookingReport(filters: Map<String, String>) : String;
     }
     class ReportService implements IReportService {
         - applicationRepo : IApplicationRepository;
         - bookingRepo : IBookingRepository;
         - projectRepo : IProjectRepository;
         - userRepo : IUserRepository;
         + ReportService(appRepo: IApplicationRepository, bookRepo: IBookingRepository, projRepo: IProjectRepository, userRepo: IUserRepository);
         + generateBookingReport(filters: Map<String, String>) : String;
     }
}

' --- Controller Layer ---
package Controller <<Folder>> {
    class ControllerContainer {
       + authController : AuthenticationController
       + userController : UserController
       + projectController : ProjectController
       + appController : ApplicationController
       + officerRegController : OfficerRegistrationController
       + bookingController : BookingController
       + receiptController : ReceiptController
       + enquiryController : EnquiryController
       + reportController : ReportController
       + ControllerContainer(auth: AuthenticationController, proj: ProjectController, app: ApplicationController, reg: OfficerRegistrationController, book: BookingController, receipt: ReceiptController, enq: EnquiryController, report: ReportController)
    }

    class UserController {
        - userService : IUserService
        + UserController(userService: IUserService)
        + getUserName(nric: String) : String
        + getUserNamesForList(nrics: Collection<String>) : Map<String, String>
    }

    class AuthenticationController {
        - authService : IAuthenticationService;
        + AuthenticationController(authService: IAuthenticationService);
        + login(nric: String, password: String) : User <<throws AuthenticationException>>
        + changePassword(user: User, newPassword: String) : boolean
    }

    class ProjectController {
        - projectService : IProjectService;
        + ProjectController(projectService: IProjectService);
        + createProject(manager: HDBManager, name: String, neighborhood: String, flatInfoMap: Map<FlatType, ProjectFlatInfo>, openDate: LocalDate, closeDate: LocalDate, officerSlots: int) : Project <<throws RegistrationException, InvalidInputException>>;
        + editProject(manager: HDBManager, projectId: String, name: String, neighborhood: String, openDate: LocalDate, closeDate: LocalDate, officerSlots: int) : boolean <<throws InvalidInputException>>;
        + deleteProject(manager: HDBManager, projectId: String) : boolean;
        + toggleVisibility(manager: HDBManager, projectId: String) : boolean;
        + getVisibleProjects(user: User, filters: Map<String, Object>) : List<Project>;
        + getAllProjects(user: HDBStaff, filters: Map<String, Object>) : List<Project>;
        + getManagedProjects(manager: HDBManager) : List<Project>;
        + findProjectById(projectId: String) : Project <<nullable>>;
    }

    class ApplicationController {
        - applicationService : IApplicationService;
        + ApplicationController(applicationService: IApplicationService);
        + submitApplication(user: User, projectId: String, preferredFlatType: FlatType <<nullable>>) : Application <<throws ApplicationException>>
        + requestWithdrawal(user: User) : boolean <<throws ApplicationException>>;
        + reviewApplication(manager: HDBManager, applicationId: String, approve: boolean) : boolean <<throws ApplicationException>>;
        + reviewWithdrawal(manager: HDBManager, applicationId: String, approve: boolean) : boolean <<throws ApplicationException>>;
        + getMyApplication(user: User) : Application <<nullable>>;
        + getProjectApplications(staff: HDBStaff, projectId: String) : List<Application>;
        + getApplicationsByStatus(staff: HDBStaff, status: ApplicationStatus) : List<Application>;
    }

    class OfficerRegistrationController {
        - registrationService : IOfficerRegistrationService;
        - projectService : IProjectService;
        + OfficerRegistrationController(regService: IOfficerRegistrationService, projService: IProjectService);
        + requestRegistration(officer: HDBOfficer, projectId: String) : OfficerRegistration <<throws RegistrationException>>;
        + reviewRegistration(manager: HDBManager, registrationId: String, approve: boolean) : boolean <<throws RegistrationException>>;
        + getMyRegistrationStatus(officer: HDBOfficer, projectId: String) : OfficerRegStatus <<nullable>>;
        + getPendingRegistrations(manager: HDBManager) : List<OfficerRegistration>;
        + getProjectRegistrations(staff: HDBStaff, projectId: String) : List<OfficerRegistration>;
        + getApprovedHandlingProject(officer: HDBOfficer) : Project;
    }

    class BookingController {
         - bookingService : IBookingService;
         + BookingController(bookingService: IBookingService);
         + createBooking(officer: HDBOfficer, applicantNric: String, flatType: FlatType) : Booking <<throws BookingException, InvalidInputException>>;
    }

    class ReceiptController {
        - receiptService : IReceiptService;
        + ReceiptController(receiptService: IReceiptService);
        + getBookingReceiptInfo(officer: HDBOfficer, booking: Booking) : BookingReceiptInfo <<throws DataAccessException>>;
    }

     class EnquiryController {
        - enquiryService : IEnquiryService;
        + EnquiryController(enquiryService: IEnquiryService);
        + createEnquiry(user: User, projectId: String <<nullable>>, content: String) : Enquiry <<throws InvalidInputException>>;
        + editMyEnquiry(user: User, enquiryId: String, newContent: String) : boolean <<throws InvalidInputException>>;
        + deleteMyEnquiry(user: User, enquiryId: String) : boolean;
        + replyToEnquiry(staff: HDBStaff, enquiryId: String, replyContent: String) : boolean <<throws InvalidInputException>>;
        + viewMyEnquiries(user: User) : List<Enquiry>;
        + viewAllEnquiries(staff: HDBStaff) : List<Enquiry>;
        + viewProjectEnquiries(staff: HDBStaff, projectId: String) : List<Enquiry>;
     }

     class ReportController {
         - reportService : IReportService;
         + ReportController(reportService: IReportService);
         + generateBookingReport(manager: HDBManager, filters: Map<String, String>) : String;
     }
}

' --- Views Layer ---
package Views <<Folder>> {
    class MainApp {
        - controllerContainer : ControllerContainer
        - currentUser : User <<nullable>>
        + MainApp(controllers: ControllerContainer)
        + {static} main(args : String[]) : void
        + run() : void
        - showLoginMenu() : void
        - routeToRoleUI(user: User) : void
    }

    abstract class BaseUI {
        # scanner : Scanner
        + BaseUI(scanner: Scanner)
        + displayMessage(message: String) : void
        + promptForInput(prompt: String) : String
        + promptForInt(prompt: String) : int
        + promptForDouble(prompt: String) : double
        + promptForDate(prompt: String) : LocalDate
        + promptForEnum(prompt: String, enumClass: Class<E>) : E
        + promptForConfirmation(prompt: String) : boolean
        # displayError(message: String) : void
        # clearConsole() : void
        # displayHeader(title: String) : void
        # displayList(items: List<T>, formatter: Function<T, String>) : void
        # pause() : void
    }

    class LoginUI extends BaseUI {
        - authController : AuthenticationController
        + LoginUI(authController: AuthenticationController, scanner: Scanner)
        + displayLogin() : User <<nullable>>
    }

    class ApplicantUI extends BaseUI {
        - user : Applicant
        - userController : UserController
        - projectController : ProjectController
        - appController : ApplicationController
        - enquiryController : EnquiryController
        + ApplicantUI(user: Applicant, projCtrl: ProjectController, appCtrl: ApplicationController, enqCtrl: EnquiryController, scanner: Scanner)
        + displayMainMenu() : void
        ' - Methods for View Projects, Submit App, View App Status, Withdraw App, View/Submit/Edit/Delete Enquiries
    }

    class HDBOfficerUI extends BaseUI {
        - user : HDBOfficer
        - userController : UserController
        - projectController : ProjectController
        - appController : ApplicationController
        - officerRegController : OfficerRegistrationController
        - bookingController : BookingController
        - receiptController : ReceiptController
        - enquiryController : EnquiryController
        + HDBOfficerUI(user: HDBOfficer, projCtrl: ProjectController, appCtrl: ApplicationController, offRegCtrl: OfficerRegistrationController, bookCtrl: BookingController, receiptCtrl: ReceiptController, enqCtrl: EnquiryController, scanner: Scanner)
        + displayMainMenu() : void
        ' - Methods for View Projects, Request Reg, View Reg Status, View App Details, Perform Booking, Generate Receipt, View/Reply Enquiries
     }

    class HDBManagerUI extends BaseUI {
        - user : HDBManager
        - userController : UserController
        - projectController : ProjectController
        - appController : ApplicationController
        - officerRegController : OfficerRegistrationController
        - enquiryController : EnquiryController
        - reportController : ReportController
        + HDBManagerUI(user: HDBManager, projCtrl: ProjectController, appCtrl: ApplicationController, offRegCtrl: OfficerRegistrationController, enqCtrl: EnquiryController, reportCtrl: ReportController, scanner: Scanner)
        + displayMainMenu() : void
        ' - Methods for CRUD Projects, Toggle Visibility, Review Apps, Review Withdrawals, Review Regs, View/Reply Enquiries, Generate Reports
     }

    class AccountUIHelper {
        - baseUI : BaseUI
        - authController : AuthenticationController

        + AccountUIHelper(BaseUI baseUI, AuthenticationController authController)
        + handlePasswordChange(User currentUser)
    }

    class ProjectUIHelper {
        - baseUI : BaseUI
        - DATE_FORMATTER : DateTimeFormatter

        + ProjectUIHelper(BaseUI baseUI)
        + selectProjectFromList(List<Project> projects, String listTitle)
        + displayApplicantProjectDetails(Project project)
        + displayStaffProjectDetails(Project project)
        - displayFlatInfoSection(Project project)
    }
}

' --- Relationships ---

' Layer Dependencies (Conceptual)
Views ..> Controller : uses >
Controller ..> Service : uses >
Service ..> Repository : uses > ' (Interface Dependency)
Service ..> Entity : uses >
Controller ..> Entity : uses >
Views ..> Entity : uses >
Repository ..> Entity : uses >

' Composition / Aggregation (Entity Relationships)
Project "1" *-- "1..*" ProjectFlatInfo : contains >
Project "1" o-- "*" Application : has >
Project "1" o-- "*" Booking : results in >
Project "1" o-- "*" Enquiry : related to >
Project "1" o-- "*" OfficerRegistration : requests for >
Project "1" -- "1" User : managed by (via managerNric) >
Project "1" -- "0..*" User : approved officers (via officerNric list) >

Application "1" -- "1" User : submitted by (via applicantNric) >
Application "1" -- "1" Project : for >
Booking "1" -- "1" Application : fulfills >
Booking "1" -- "1" Project : for >
Booking "1" -- "1" User : by (via applicantNric) >
Enquiry "1" -- "1" User : submitted by (via userNric) >
OfficerRegistration "1" -- "1" User : requested by (via officerNric) >
OfficerRegistration "1" -- "1" Project : for >

' Interface Implementation
IUserRepository <|.. UserRepository
IProjectRepository <|.. ProjectRepository
IApplicationRepository <|.. ApplicationRepository
IBookingRepository <|.. BookingRepository
IEnquiryRepository <|.. EnquiryRepository
IOfficerRegistrationRepository <|.. OfficerRegistrationRepository

IAuthenticationService <|.. AuthenticationService
IBookingService <|.. BookingService
IReceiptService <|.. ReceiptService
IEligibilityService <|.. EligibilityService
IProjectService <|.. ProjectService
IApplicationService <|.. ApplicationService
IOfficerRegistrationService <|.. OfficerRegistrationService
IEnquiryService <|.. EnquiryService
IReportService <|.. ReportService

' Key Service Dependencies (Illustrative)
AuthenticationService ..> IUserRepository : uses >
ProjectService ..> IProjectRepository : uses >
ProjectService ..> IUserRepository : uses >
ApplicationService ..> IApplicationRepository : uses >
ApplicationService ..> IProjectRepository : uses >
ApplicationService ..> IUserRepository : uses >
ApplicationService ..> IBookingRepository : uses >
ApplicationService ..> IEligibilityService : uses >
BookingService ..> IApplicationRepository : uses >
BookingService ..> IProjectRepository : uses >
BookingService ..> IBookingRepository : uses >
BookingService ..> IUserRepository : uses >
ReceiptService ..> IBookingRepository : uses >
ReceiptService ..> IUserRepository : uses >
ReceiptService ..> IProjectRepository : uses >
OfficerRegistrationService ..> IOfficerRegistrationRepository : uses >
OfficerRegistrationService ..> IProjectRepository : uses >
OfficerRegistrationService ..> IApplicationRepository : uses >
OfficerRegistrationService ..> IEligibilityService : uses >
EnquiryService ..> IEnquiryRepository : uses >
ReportService ..> IApplicationRepository : uses >
ReportService ..> IBookingRepository : uses >
ReportService ..> IProjectRepository : uses >
ReportService ..> IUserRepository : uses >

' Controller Dependencies
AuthenticationController ..> IAuthenticationService : uses >
ProjectController ..> IProjectService : uses >
ApplicationController ..> IApplicationService : uses >
OfficerRegistrationController ..> IOfficerRegistrationService : uses >
BookingController ..> IBookingService : uses >
ReceiptController ..> IReceiptService : uses >
EnquiryController ..> IEnquiryService : uses >
ReportController ..> IReportService : uses >

' UI Dependencies
MainApp --> ControllerContainer : aggregates >
MainApp --> LoginUI : creates >
MainApp --> ApplicantUI : creates >
MainApp --> HDBOfficerUI : creates >
MainApp --> HDBManagerUI : creates >

LoginUI ..> AuthenticationController : uses >
ApplicantUI ..> ProjectController : uses >
ApplicantUI ..> ApplicationController : uses >
ApplicantUI ..> EnquiryController : uses >
HDBOfficerUI ..> ProjectController : uses >
HDBOfficerUI ..> ApplicationController : uses >
HDBOfficerUI ..> OfficerRegistrationController : uses >
HDBOfficerUI ..> BookingController : uses >
HDBOfficerUI ..> ReceiptController : uses >
HDBOfficerUI ..> EnquiryController : uses >
HDBManagerUI ..> ProjectController : uses >
HDBManagerUI ..> ApplicationController : uses >
HDBManagerUI ..> OfficerRegistrationController : uses >
HDBManagerUI ..> EnquiryController : uses >
HDBManagerUI ..> ReportController : uses >

' Utility Dependencies
Views .> InputUtil : uses >
Views .> FileUtil : uses >
Repository ..> FileUtil : uses >
Service ..> PasswordUtil : uses >
Service ..> IdGenerator : uses >
Service ..> FileUtil : uses >

@enduml